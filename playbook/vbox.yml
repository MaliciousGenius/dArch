---

- hosts: mothership
  vars:
    ansible_connection: local
    # Arch's default python is python3
    ansible_python_interpreter: "/usr/bin/env python2"
  sudo: false
  user: system
  tasks:
    - name: Update Arch
      pacman:
        update_cache: yes
        upgrade: yes
      sudo: true

    - name: Install packages
      pacman:
        name: "{{ item }}"
        state: "present"
        update_cache: yes
      with_items:
         - virtualbox-guest-utils
         - virtualbox-guest-modules
         - virtualbox-guest-modules-lts
         - virtualbox-guest-dkms
      sudo: true

    - name: Touch xorg.con
      command: "echo 'vboxguest' '\n' 'vboxsf' '\n' 'vboxvideo' > /etc/modules-load.d/virtualbox.conff"
      sudo: true